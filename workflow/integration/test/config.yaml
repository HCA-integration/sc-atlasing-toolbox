output_dir: test/out
images: test/images

use_gpu: true
env_mode: local

resources:
  cpu:
    partition: cpu
    qos: normal
    gpu: 0
    mem_mb: 1000
  gpu:
    partition: gpu
    qos: normal
    gpu: 1
    mem_mb: 4000

defaults:
  integration:
    raw_counts: counts
    norm_counts: X
    methods:
      bbknn:
      combat:
      scanorama:
      scanvi:
        n_hidden: 128
        dispersion: gene
        max_epochs: 10
        use_observed_lib_size: true
      scgen:
        n_epochs: 10
      unintegrated:
  datasets:
    - test
    - test2
    - test3
    - harmony_comparison
    - scpoli
    - scvi


DATASETS:
  test:
    input:
      integration:
        pbmc: test/input/pbmc68k.h5ad
    integration:
      label:
        - bulk_labels
        - louvain
      batch:
        - phase
        - batch_2

  test2:
    input:
      integration: test/input/pbmc68k.h5ad
    integration:
      label: bulk_labels
      batch: batch
      methods:
        unintegrated:
      umap_colors:
        - bulk_labels
        - phase

  test3:
    input:
      integration: test/input/preprocessing/dataset~all/file_id~pbmc/preprocessed.zarr
    integration:
      raw_counts: raw
      norm_counts: X
      label: bulk_labels
      batch: batch
      methods:
        unintegrated:
        scgen:
          n_epochs: 10

  harmony_comparison:
    input:
      integration: test/input/pbmc68k.h5ad
    integration:
      label: bulk_labels
      batch: batch
      methods:
        harmony_rapids:
        harmonypy:
        harmony:
      umap_colors:
        - bulk_labels
        - phase

  scpoli:
    input:
      integration: test/input/pbmc68k.h5ad
    integration:
      label: bulk_labels
      batch: batch
      methods:
        scpoli:
          supervised:
            - true
            - false
          model:
            embedding_dims: 5
            recon_loss: nb
          train:
            n_epochs: 50
      umap_colors:
        - bulk_labels
        - phase

  scvi:
    input:
      integration:
        orig: test/input/pbmc68k.h5ad
        prepr: test/input/preprocessing/dataset~all/file_id~pbmc/preprocessed.zarr
    integration:
      raw_counts: raw
      norm_counts: X
      label: bulk_labels
      batch: batch
      methods:
        scvi:
          n_hidden: 128
          dispersion:
            - gene
            - gene-batch
            - gene-label
            - gene-cell
          max_epochs: 10
          use_observed_lib_size: true
      umap_colors:
        - phase