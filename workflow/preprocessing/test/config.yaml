output_dir: test/out
dataset_meta: test/datasets.tsv
images: test/images

# env_mode: from_yaml
use_gpu: true

defaults:
  preprocessing:
    neighbors:
      n_neighbors: 15
      n_pcs: 50
  datasets:
    - large
    # - all
    # - no_hvg
    # - empty
    # - test_backed
    # - test_dask
    # - test_dask_backed

DATASETS:
  large:
    input:
      preprocessing:
        blood: test/input/load_data/merged/organ/blood.zarr
    preprocessing:
      dask: true
      raw_counts: X
      batch: dataset
      lineage: cell_type
      scale: false
      highly_variable_genes:
        n_top_genes: 2000
        subset: true
      assemble:
        - counts
        - normalize
        - highly_variable_genes
        - pca
        - neighbors
      colors:
        - cell_type
        - study
        - development_stage
  
  all:
    input:
      preprocessing:
        pbmc: test/input/pbmc68k.h5ad
    preprocessing:
      raw_counts: layers/counts
      scale: true
      highly_variable_genes:
        n_top_genes: 100
        subset: true
      assemble:
        - counts
        - normalize
        - highly_variable_genes
        - pca
        - neighbors
        - umap

  no_hvg:
    input:
      preprocessing:
        pbmc: test/input/pbmc68k.h5ad
    preprocessing:
      raw_counts: layers/counts
      highly_variable_genes: false
      assemble:
        - highly_variable_genes
        - pca
      colors:
        - bulk_labels
        - batch

  empty:
    input:
      preprocessing:
        pbmc: test/input/empty.zarr

  test_backed: # should just go with in-memory reading
    input:
      preprocessing:
        pbmc: test/input/pbmc68k.h5ad
    preprocessing:
      backed: true
      raw_counts: layers/counts
      assemble:
        - umap

  test_dask:
    input:
      preprocessing:
        pbmc: test/input/pbmc68k.h5ad
    preprocessing:
      dask: true
      raw_counts: layers/counts
      assemble:
        - umap

  test_dask_backed:
    input:
      preprocessing:
        pbmc: test/input/pbmc68k.h5ad
    preprocessing:
      dask: true
      backed: true
      raw_counts: layers/counts
      assemble:
        - umap